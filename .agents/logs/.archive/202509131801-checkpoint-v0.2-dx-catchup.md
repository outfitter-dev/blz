---
date: 2025-09-13 18:01 UTC
branch: gt-v0.2/feat_anchors_add_anchors_to_parser_index_search_json_new_blz_anchor_list_get_update-time_anchors.json_remap_head_preflight_windowed_segmentation_fallback_docs_generator_keep_clippy_tests_green
slug: checkpoint-v0.2-dx-catchup
agent: codex
---

# Checkpoint - v0.2 DX catch-up

## Summary

Synchronized local context with the v0.2 “DX & Stability” worklog. Verified current stack with Graphite and validated the workspace builds and tests. The gist’s “Changes Landed” are reflected in code (clean JSON/logging, camelCase schema, CLI UX updates, pagination metadata, actionable errors, source health), and work has started on anchors, HEAD preflight, windowed segmentation fallback, and a docs generator.

Reference: https://gist.github.com/galligan/0b31256f3522f05082429a52bff010dc

## Tasks

### Done

- Addresses: #150 — Logs → stderr, clean JSON/NDJSON on stdout, broken-pipe safe panic hook, `--quiet` honored
- Addresses: #151 — Standardized JSON schema (camelCase), `sourceUrl` and `checksum` populated, `list --output json` `fetchedAt`; examples updated to `.results[]`
- Addresses: #156 — CLI UX: `--source` synonym for `--alias`, `-s` short flag; top-level parity
- Addresses: #161/#154 — `blz instruct` includes appended `--help`; onboarding examples aligned
- Addresses: #152 (foundation) — Parser sorts headings pre-segmentation; `parse_meta` added; index computes exact line when possible; tests updated
- Addresses: #159 — Pagination UX: `--last`; JSON includes page/limit/totalResults/totalPages/totalLinesSearched/searchTimeMs/sources/results
- Addresses: #157 — Actionable errors on `get` (invalid `--lines`) and `search` (unknown alias hint)
- Addresses: #160 (part) — `list --status` health metadata (ETag, Last-Modified, checksum); `lookup` HEAD health summary; `add` preflight scheme sanity
- Docs updated to reflect JSON shape and `--last`; `instruct` behavior clarified
- #160 follow-up — Added HEAD preflight to `update` with size and ETA hints; fails fast on non-2xx
- Docs – Updated `docs/cli.md` JSON example to new camelCase shape with pagination metadata; documented `ndjson` and global `BLZ_OUTPUT_FORMAT`
 - #152 — Added core anchor remap utility `compute_anchor_mappings` + tests; `update` now uses it to persist anchors.json

### In Progress

- #160 preflight follow-up — More robust HEAD preflight summary, non-2xx failures, size/ETA hints
- #152 durable indexing (deeper) — Hybrid windowed fallback for structured ambiguities; content anchors/fingerprints to remap across updates; fixtures and “text moved” tests
- #154 docs generator — `blz docs --format markdown|json` from Clap definitions and shared generator for `--help`/`instruct`
- Anchors feature — Parser/index/search JSON carry stable `anchor`; `blz anchor list/get`; update-time `anchors.json` remap

### Not Started

- #158 — Fuzzy search + suggestions; phrase/boolean queries
- #162 — Short-TTL LRU cache for search results + invalidation on update
- Post v0.2: #153 registry + CI validation; #155 `blz explain`

## Changes

- CLI: `crates/blz-cli/src/main.rs`, `cli.rs`, `commands/*`, `output/*` (instruct+help, `--source` alias, docs generator, anchors subcommands)
- Core: `crates/blz-core/src/parser.rs`, `index.rs`, `types.rs`, `fetcher.rs` (parse_meta, exact-line citations, anchors, preflight)
- Docs: `docs/*`, `crates/blz-cli/docs/OUTPUT-FORMATS.md` (JSON shape, `.results[]`, pagination metadata)

## Decisions & Rationale

- Standardize API output to camelCase for stable downstream consumption
- Separate logs (stderr) from machine-readable stdout to keep JSON clean
- Add parse metadata to support durable mapping across updates and future fallbacks
- Introduce anchors to make citations resilient as text moves

## Current State

- Branch Status: current branch is `gt-v0.2/feat_anchors_*` atop `gt-v0.2/dx`; stack restacked on latest `main`
- CI Status: local `cargo check` passes; tests pass for blz-core and blz-cli
- PR Stack: Graphite stack present; anchor+preflight+docs work staged on top of v0.2/dx
- Open Items: Must-haves remain for v0.2 (preflight follow-up, durable indexing/anchors tests, docs generator output and integration)

## Blockers

- None identified; follow-up implementation and tests needed for anchors remap and hybrid segmentation

## Next Steps

1. Complete HEAD preflight summary and error paths (#160)
2. Finalize hybrid windowed segmentation fallback and add “text moved” fixtures/tests (#152)
3. Finish `blz docs` generator and wire into `instruct`/`--help` (#154)
4. Add integration tests covering anchors remap across updates and exact-line fallback
5. Update CLI/docs examples where anchors and docs generator affect UX

## Follow-ups

- Evaluate fuzzy/suggestions and LRU caching (#158, #162) for potential inclusion if time permits
- Plan for registry bootstrap and `blz explain` post v0.2 (#153, #155)

## Context/Notes

- Gist confirms scope and priorities for v0.2 DX & Stability
- Local tests show anchors and docs generator code paths exist; completions include `docs` and `anchor` commands
